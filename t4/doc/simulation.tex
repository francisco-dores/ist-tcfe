\section{Simulation Analysis}
\label{sec:simulation}

\subsection{Audio Amplifier Simulation}
\label{subsec:amp_simulation}
\par In this section we simulate an audio amplifier through the NGspice tool. Our goal is to simulate the audio amplifier using two different kinds of transistors (NPN and PNP). It is our objetive to measure the output voltage gain in the passband and the lower and upper 3dB cut off frequencies, as well as the input and output impedances.

\par  \textbf{Important note:} Beyond modelling and analysing the circuit provided, one of the goals of this laboratory assignment is to maximize the merit, which is computed according to the following formula:
\begin{equation}
M = \frac{\text{voltageGain}*\text{bandwidth}}{\text{cost}*\text{lowerCutoffFreq}}
\end{equation}

Therefore, it was our intention to obtain the best value for this parameter,using each of the variables in order to maximize it, wich means that we have not tried to improve each of those separately, but as a all.
In order to do it we used the values indicated the following values of the components: $R_{B1}=79k\Omega$, $R_{B2}=9.2k\Omega$, $R_{C1}=2.4k\Omega$, $R_{E1}=150\Omega$, $R_{E2}=320\Omega$, $C_{i}=5uF$, $C_{b}=270uF$ and $C_{o}=120uF$.   
  

\begin{table}[H]
  \centering
  \begin{tabular}{ |l|r| } 
    \hline    
    {\bf Merit} & {\bf Value} \\ \hline
    \input{../sim/merit_tab}
  \end{tabular}
  \caption{Merit Calculation}
  \label{tab:merit}
\end{table}

\subsection{Output Voltage Gain}
\label{output_gain}
\par In order to compute the output voltage gain, we used Ngspice's \textit{abs} function to determine the the magnitude coefficient between the output voltage (v(out)) and the input voltage (v(in2)).

 In the following table, we present the maximum magnitude of the gain (v(out)), in decibels:
 
\begin{table}[H]
  \centering
  \begin{tabular}{|l|r|}
    \hline    
    {\bf Output Voltage Gain} & {\bf Value} \\ \hline
    \input{../sim/gain_tab}
  \end{tabular}
  \caption{Maximum Gain Magnitude, in dB}
  \label{tab:gain}
\end{table}



\subsection{Frequency response}
\label{frequency_response}
In this subsection, we use the Ngspice's \textit{measure} function to compute the value of the lower and upper 3db cut off frequencies, which allowed the calculation of the bandwidth, which is the difference of the two variables previosuly mentioned. Beyond this, it is also presented the Bandwidth wich is the difference between the lower and upper cut off frequencies. The results obtained are shown in the table bellow:

\begin{table}[H]
  \centering
  \begin{tabular}{|l|r|}
    \hline    
    {\bf Variable} & {\bf Value [Hz]} \\ \hline
    \input{../sim/results_tab}
  \end{tabular}
  \caption{Lower and Upper Cut off Frequencies and Bandwidth, in Hz}
  \label{tab:frequency_response}
\end{table}

In order to compare and understand the evolution of the circuit from the gain stage to the output stage we firstly show the magnitude and the the phase plots in the collector node (the output of the gain stage) and then the same quantities regarding the output stage:

\begin{figure}[H] \centering
\includegraphics[clip, trim=1.3cm 1.3cm 0cm 7cm, width=0.6\linewidth]{vcolldb.pdf}
\caption{v(coll) magnitude, in dB}
\label{fig:voutdb}
\end{figure}
 
 
\begin{figure}[H] \centering
\includegraphics[clip, trim=1.3cm 1.3cm 0cm 7cm, width=0.6\linewidth]{vcollp.pdf}
\caption{v(coll) phase, in rad}
\label{fig:voutp}
\end{figure}


\par Next, we present the graphical representation of both the magnitude and the phase frequency response at the output stage:\par
 

\begin{figure}[H] \centering
\includegraphics[clip, trim=1.3cm 1.3cm 0cm 7cm, width=0.6\linewidth]{voutdb.pdf}
\caption{Gain / v(out) magnitude, in dB}
\label{fig:voutdb}
\end{figure}

\begin{figure}[H] \centering
\includegraphics[clip, trim=1.3cm 1.3cm 0cm 7cm, width=0.6\linewidth]{voutp.pdf}
\caption{Gain / v(out) phase, in rad}
\label{fig:voutp}
\end{figure}


\subsection{Impedances}
\label{impedances}
Finally, in this subsection the input impedance and the output impedance are presented.
Both input and output impedances are given by the coefficient between the voltage and the current in the input and output branches, respectively
We can verify from the values that the goal of having a higher input impedance and a lower output impedance was achieved, wich allowed us to obtain a better amplifier:


\begin{table}[H]
  \centering
  \begin{tabular}{|l|r|}
    \hline    
    {\bf Input Impedance} & {\bf Value [S]} \\ \hline
    \input{../sim/inputZ_tab}
  \end{tabular}
  \caption{Input Impedance, in Siemens}
  \label{tab:input_z}
\end{table}


\begin{table}[H]
  \centering
  \begin{tabular}{|l|r|}
    \hline    
    {\bf Output Impedance} & {\bf Value [S]} \\ \hline
    \input{../sim/outputZ_tab}
  \end{tabular}
  \caption{Output Impedance, in Siemens}
  \label{tab:output_z}
\end{table}



